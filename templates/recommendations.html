{% extends "base.html" %}
{% block title %}ğŸ” Î ÏÎ¿Ï„Î¬ÏƒÎµÎ¹Ï‚{% endblock %}

{% block content %}
<h1>ğŸŒŸ Î ÏÎ¿Ï„Î¬ÏƒÎµÎ¹Ï‚ Î³Î¹Î±: {{ user_id }}</h1>

{% if recommendations %}
<div class="grid">
    {% for item in recommendations %}
    <div class="card">
        <img src="{{ item.imUrl or '/static/no-image.png' }}" alt="Image" onerror="this.src='/static/no-image.png'">
        <h3>{{ item.title }}</h3>
        <p class="similarity">Similarity: {{ "%.4f"|format(item.similarity) }}</p>

        <a href="https://www.amazon.com/dp/{{ item.asin }}" target="_blank" class="btn-primary">
            Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ±
        </a>

        <button class="btn-primary" onclick="addToFavorites('{{ item.asin }}')">
            â¤ï¸ Î‘Î³Î±Ï€Î·Î¼Î­Î½Î¿
        </button>

        <a href="/export_csv?user_id={{ user_id }}" target="_blank" class="btn-primary" style="margin-top: 0.5rem; display: inline-block; text-decoration: none;">
            â¬‡ï¸ Î•Î¾Î±Î³Ï‰Î³Î® ÏƒÎµ CSV
        </a>
    </div>
    {% endfor %}
</div>
{% else %}
<p>Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Ï€ÏÎ¿Ï„Î¬ÏƒÎµÎ¹Ï‚ Î³Î¹Î± Ï„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î·/Ï€ÏÎ¿ÏŠÏŒÎ½.</p>
{% endif %}

<script>
    function addToFavorites(asin) {
        asin = asin.trim();
        let favs = JSON.parse(localStorage.getItem('favorites')) || [];
    
        // Î‘Ï€Î¿Ï„ÏÎ­Ï€Î¿Ï…Î¼Îµ Ï„Î± Î´Î¹Ï€Î»ÏŒÏ„Ï…Ï€Î± Î¼Îµ indexOf
        if (favs.indexOf(asin) === -1) {
            favs.push(asin);
            localStorage.setItem('favorites', JSON.stringify(favs));
            alert("Î ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎµ ÏƒÏ„Î± Î±Î³Î±Ï€Î·Î¼Î­Î½Î±!");
        } else {
            alert("Î¥Ï€Î¬ÏÏ‡ÎµÎ¹ Î®Î´Î· ÏƒÏ„Î± Î±Î³Î±Ï€Î·Î¼Î­Î½Î±.");
        }
    }
    </script>
    
</script>
{% endblock %}
